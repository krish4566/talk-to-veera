<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asking Veera</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Custom styles for the message bubbles */
      .message {
          border-radius: 1.25rem;  /* Rounded corners */
          padding: 0.75rem 1rem;    /* Padding inside the bubble */
          margin-bottom: 0.5rem;  /* Space between messages */
          max-width: 85%;         /* Maximum width of the bubble */
          display: inline-block;  /* Important for width and alignment */
      }
      .user-message {
          background-color: #e0f2fe; /* Light blue for user messages */
          color: #0369a1;         /* Darker blue text */
          margin-left: auto;       /* Push user messages to the right */
          text-align: right;
      }
      .veera-message {
          background-color: #f0f4c3;  /* Light yellow for Veera's messages */
          color: #1a5235;         /* Dark green text */
          margin-right: auto;      /* Push Veera's messages to the left */
          text-align: left;
      }
      .system-message {
          background-color: #f0f0f0; /* Light gray for system messages */
          color: #444444;
          margin: 0.5rem auto;
          text-align: center;
          width: 90%;
          border-radius: 1.25rem;
          padding: 0.75rem 1rem;
      }
      .loading-indicator {
          display: inline-flex;
          align-items: center;
      }
      .loading-indicator span {
          width: 0.5rem;
          height: 0.5rem;
          border-radius: 50%;
          background-color: #4a5568; /* Gray dots */
          margin: 0 0.25rem;
          animation: pulse 1.5s infinite;
      }
      .loading-indicator span:nth-child(2) {
          animation-delay: 0.5s;
      }
      .loading-indicator span:nth-child(3) {
          animation-delay: 1s;
      }
      @keyframes pulse {
          0% { opacity: 0.2; }
          50% { opacity: 1; }
          100% { opacity: 0.2; }
      }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-100 to-pink-100 min-h-screen flex flex-col font-sans">
    <header class="py-4 text-center">
        <h1 class="text-2xl sm:text-3xl font-semibold text-gray-800">Asking Veera</h1>
    </header>

    <main class="flex-1 overflow-y-auto" id="chat-container">
        <div class="system-message">
            <p>Welcome! Ask me anything.</p>
        </div>
    </main>

    <footer class="py-4 text-center">
        <div class="flex items-center justify-center gap-2 p-2">
            <textarea
                id="prompt-input"
                placeholder="Enter your question..."
                rows="1"
                class="w-full sm:w-3/4 md:w-1/2 px-4 py-2 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:border-transparent bg-white text-gray-700 shadow-sm"
                ></textarea>
            <button id="send-button" class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold rounded-xl px-6 py-2 shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 transition-colors duration-300">
                Ask Veera
            </button>
        </div>
    </footer>

    <script>
    const chatContainer = document.getElementById('chat-container');
    const promptInput = document.getElementById('prompt-input');
    const sendButton = document.getElementById('send-button');
    const apiKey = 'AIzaSyBxcFV18VvEUTsKDnxuOp1aVJgP6GrA_6A'; // **Replace with your actual API key**
    const apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';

    function createMessageElement(text, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message');
        messageDiv.classList.add(sender + '-message');
        messageDiv.textContent = text;
        return messageDiv;
    }

    function createLoadingIndicator() {
        const loadingDiv = document.createElement('div');
        loadingDiv.classList.add('message', 'veera-message', 'loading-indicator');
        loadingDiv.innerHTML = '<span></span><span></span><span></span>';
        return loadingDiv;
    }

    async function sendMessage() {
        const promptText = promptInput.value.trim();
        if (!promptText) return;

        const userMessage = createMessageElement(promptText, 'user');
        chatContainer.appendChild(userMessage);
        promptInput.value = ''; // Clear the input

        const loadingIndicator = createLoadingIndicator();
        chatContainer.appendChild(loadingIndicator);

        try {
            const response = await fetch(`${apiUrl}?key=${apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: promptText }]
                    }]
                }),
            });

            if (!response.ok) {
                const errorData = await response.json(); // Attempt to get error details
                throw new Error(`Gemini API error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
            }

            const data = await response.json();
            console.log("Gemini API Response:", data); // Log the entire response for debugging

            chatContainer.removeChild(loadingIndicator); // Remove loading indicator

            let responseText = 'No response received.'; // Default message
            if (data.candidates && data.candidates.length > 0 && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts.length > 0) {
                responseText = data.candidates[0].content.parts[0].text;
            }
            const veeraMessage = createMessageElement(responseText, 'veera');
            chatContainer.appendChild(veeraMessage);

        } catch (error) {
            console.error('Error calling Gemini API:', error);
            chatContainer.removeChild(loadingIndicator); // Remove loading indicator on error
            const errorMessage = createMessageElement(`Error: ${error.message}`, 'system');
            chatContainer.appendChild(errorMessage);
        } finally {
            // Ensure scroll to bottom, even with errors
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
    }

    sendButton.addEventListener('click', sendMessage);
    promptInput.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault(); // Prevent newline in textarea
            sendMessage();
        }
    });

    // Adjust textarea height dynamically
    promptInput.addEventListener('input', () => {
        promptInput.style.height = 'auto';
        promptInput.style.height = `${promptInput.scrollHeight}px`;
    });
    </script>
</body>
</html>
